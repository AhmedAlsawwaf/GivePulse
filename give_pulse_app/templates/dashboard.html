{% extends "base.html" %}
{% load static %}

{% block title %}Dashboard - GivePulse{% endblock %}

{% block content %}
<section class="dashboard-section py-5">
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-lg-8">
        <!-- Dashboard Card -->
        <div class="card shadow border-0 rounded-4 overflow-hidden animate__animated animate__fadeInUp">
          <div class="card-header bg-light text-center py-4">
            <h3 class="fw-bold text-primary-red mb-1">
              Welcome, {{ user.first_name }} {{ user.last_name }}
            </h3>
            <p class="text-muted mb-0 small">
              Role: <span class="fw-semibold text-secondary-green">{{ user.role|title }}</span>
            </p>
          </div>

          <div class="card-body p-4">
            <!-- User Info -->
            <div class="d-flex align-items-center justify-content-between">
              <div>
                <h5 class="text-secondary-green fw-semibold mb-2">
                  <i class="bi bi-person-circle me-2"></i> Profile Information
                </h5>
                <ul class="list-unstyled mb-0">
                  <li><strong>Email:</strong> {{ user.email }}</li>
                  <li><strong>Phone:</strong> {{ user.phone|default:"â€”" }}</li>
                </ul>
              </div>
              <div>
                {% if user.donor.profile_picture %}
                  <div class="text-center mt-3">
                    <img src="{{ user.donor.profile_picture.url }}" 
                          alt="Profile Picture" 
                          class="rounded-circle shadow-sm" 
                          width="140" height="140">
                  </div>
                {% else %}
                  <p class="text-muted fst-italic">No profile picture uploaded.</p>
                {% endif %}
              </div>
            </div>

            <!-- Donor Section -->
            {% if user.donor %}
              <hr>
              <div class="mb-4">
                <h5 class="text-secondary-green fw-semibold mb-3">
                  <i class="bi bi-droplet-half me-2"></i> Donor Profile
                </h5>
                <p><strong>ABO/Rh:</strong> {{ user.donor.abo }}{{ user.donor.rh }}</p>
                <p><strong>City:</strong> {{ user.donor.city }}</p>
                {% if user.donor.last_donation %}
                    <h6 class="text-muted">Last Donation</h6>
                    <p class="mb-3">{{ user.donor.last_donation|date:"M d, Y" }}</p>
                {% endif %}
                
                {% if user.donor.is_in_cooldown %}
                    <h6 class="text-muted">Cooldown Status</h6>
                    <p class="mb-3 text-warning">
                        <i class="bi bi-clock"></i> In cooldown until {{ user.donor.cooldown_until|date:"M d, Y H:i" }}
                    </p>
                {% else %}
                    <h6 class="text-muted">Cooldown Status</h6>
                    <p class="mb-3 text-success">
                        <i class="bi bi-check-circle"></i> Ready to donate
                    </p>
                {% endif %}
                
                <!-- Blood Requests Button -->
                <a href="{% url 'blood_requests_list' %}" class="btn btn-primary-red mt-2 me-2">
                     Browse Blood Requests
                </a>
                
                <!-- My Matches Button -->
                <a href="{% url 'donor_matches' %}" class="btn btn-secondary-custom mt-2 me-2">
                    My Matches
                </a>
                
                <!-- My Appointments Button -->
                <a href="{% url 'donor_appointments' %}" class="btn btn-secondary-custom mt-2 me-2">
                   My Appointments
                </a>
                
                <!-- My Donations Button -->
                <a href="{% url 'donor_donations' %}" class="btn btn-secondary-custom mt-2">
                   My Donations
                </a>
              </div>
            {% endif %}

            <!-- Staff Section -->
            {% if user.staff %}
              <hr>
              <div class="mb-4">
                <h5 class="text-secondary-green fw-semibold mb-3">
                  <i class="bi bi-hospital-fill me-2"></i> Staff Profile
                </h5>
                <p><strong>Hospital:</strong> {{ user.staff.hospital }}</p>
                <p><strong>Verified:</strong>
                  {% if user.staff.is_verified %}
                    <span class="badge bg-success">Yes</span>
                  {% else %}
                    <span class="badge bg-warning text-dark">Pending</span>
                  {% endif %}
                </p>

                <!-- Staff Actions -->
                {% if user.staff %}
                  <div class="d-grid gap-2">
                    <a href="{% url 'blood_request_new' %}" class="btn btn-primary-red">
                       Create Blood Request
                    </a>
                    <a href="{% url 'staff_blood_requests' %}" class="btn btn-secondary-custom">
                   Manage Requests
                    </a>
                  </div>
                {% else %}
                  <p class="text-muted mt-2">
                    <em>Your account must be verified to create requests.</em>
                  </p>
                {% endif %}
              </div>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Bootstrap Icons -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
{% endblock %}
