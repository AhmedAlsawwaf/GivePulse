{% extends "base.html" %}
{% load static %}

{% block title %}Match Blood Request{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card shadow">
                <div class="card-header bg-success text-white">
                    <h4 class="mb-0">
                        <i class="bi bi-heart"></i> Match Blood Request
                    </h4>
                </div>
                <div class="card-body">
                    <div class="alert alert-info">
                        <h5><i class="bi bi-info-circle"></i> Request Details</h5>
                        <p><strong>Hospital:</strong> {{ blood_request.hospital.name }}</p>
                        <p><strong>Blood Type:</strong> {{ blood_request.abo }}{{ blood_request.rh }}</p>
                        <p><strong>Location:</strong> {{ blood_request.city.name }}</p>
                        <p><strong>Deadline:</strong> {{ blood_request.deadline_at|date:"M d, Y H:i" }}</p>
                    </div>

                    {% if is_compatible %}
                        <div class="alert alert-success">
                            <h5><i class="bi bi-check-circle"></i> Blood Type Compatibility Confirmed</h5>
                            <p>Your blood type ({{ user.donor.abo }}{{ user.donor.rh }}) is compatible with this request ({{ blood_request.abo }}{{ blood_request.rh }}).</p>
                        </div>

                        <div class="alert alert-warning">
                            <h5><i class="bi bi-exclamation-triangle"></i> Important Information</h5>
                            <ul class="mb-0">
                                <li>By matching this request, you are committing to donate blood if accepted by the hospital staff.</li>
                                <li>You will be contacted by the hospital for scheduling your donation appointment.</li>
                                <li>After donation, you will have an 8-week cooldown period before you can match new requests.</li>
                                <li>Please ensure you are healthy and meet all donation requirements.</li>
                            </ul>
                        </div>

                        <form method="post">
                            {% csrf_token %}
                            <div class="d-grid gap-2">
                                <button type="submit" class="btn btn-success btn-lg">
                                    <i class="bi bi-heart"></i> Confirm Your Match
                                </button>
                                <a href="{% url 'blood_request_detail' blood_request.id %}" class="btn btn-outline-secondary">
                                    <i class="bi bi-arrow-left"></i> Cancel
                                </a>
                            </div>
                        </form>
                    {% else %}
                        <div class="alert alert-danger">
                            <h5><i class="bi bi-x-circle"></i> Blood Type Incompatible</h5>
                            <p>Your blood type ({{ user.donor.abo }}{{ user.donor.rh }}) is not compatible with this request ({{ blood_request.abo }}{{ blood_request.rh }}).</p>
                            <p>You cannot match this request due to medical compatibility requirements.</p>
                        </div>
                        <div class="d-grid">
                            <a href="{% url 'blood_request_detail' blood_request.id %}" class="btn btn-outline-secondary">
                                <i class="bi bi-arrow-left"></i> Back to Request Details
                            </a>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
